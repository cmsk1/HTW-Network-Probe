<app-navbar></app-navbar>

<main>
  <div class="row">
    <div class="col-auto">
      <div class="d-flex flex-column flex-shrink-0 p-3 bg-light side-nav">
        <a class="d-flex align-items-center mb-0 me-md-auto link-dark text-decoration-none">
          <span class="fs-5">Start</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-3">
          <li class="nav-item">
            <a class="nav-link pointer" [ngClass]="tab === 'connect' ? 'active' : 'link-dark'" (click)="tab = 'connect'">
              <span class="faFixedSize"><fa-icon [icon]="faEthernet"></fa-icon></span>
              Verbindung
            </a>
          </li>
        </ul>
        <a class="d-flex align-items-center mb-0 me-md-auto link-dark text-decoration-none">
          <span class="fs-5">Überwachung</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-3">
          <li class="nav-item">
            <a class="nav-link pointer" [ngClass]="tab === 'network' ? 'active' : 'link-dark'" (click)="tab = 'network'">
              <span class="faFixedSize"><fa-icon [icon]="faSatelliteDish"></fa-icon></span>
              Netzwerk
              <span class="float-end text-danger" *ngIf="checkCSQActive"><fa-icon [icon]="faPlay"></fa-icon></span>
            </a>
          </li>
          <li>
            <a class="nav-link pointer" [ngClass]="tab === 'internet' ? 'active' : 'link-dark'" (click)="tab = 'internet'">
              <span class="faFixedSize"><fa-icon [icon]="faWifi"></fa-icon></span>
              Internet
            </a>
          </li>
        </ul>
        <a class="d-flex align-items-center mb-0 me-md-auto link-dark text-decoration-none">
          <span class="fs-5">Diagnose</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
          <li class="nav-item">
            <a class="nav-link pointer" [ngClass]="tab === 'device' ? 'active' : 'link-dark'" (click)="tab = 'device'">
              <span class="faFixedSize"><fa-icon [icon]="faMicrochip"></fa-icon></span>
              Gerät
            </a>
          </li>
          <li>
            <a class="nav-link pointer" [ngClass]="tab === 'connection' ? 'active' : 'link-dark'" (click)="tab = 'connection'">
              <span class="faFixedSize"><fa-icon [icon]="faEthernet"></fa-icon></span>
              Verbindung
            </a>
          </li>
          <li>
            <a class="nav-link pointer" [ngClass]="tab === 'sms' ? 'active' : 'link-dark'" (click)="tab = 'sms'">
              <span class="faFixedSize"><fa-icon [icon]="faSms"></fa-icon></span>
              SMS
            </a>
          </li>
          <li>
            <a class="nav-link pointer" [ngClass]="tab === 'phonebook' ? 'active' : 'link-dark'" (click)="tab = 'phonebook'">
              <span class="faFixedSize"><fa-icon [icon]="faAddressBook"></fa-icon></span>
              Telefonbuch
            </a>
          </li>
          <li>
            <a class="nav-link pointer" [ngClass]="tab === 'at' ? 'active' : 'link-dark'" (click)="tab = 'at'">
              <span class="faFixedSize"><fa-icon [icon]="faTerminal"></fa-icon></span>
              AT Befehle
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="col">
      <section class="mt-2">
        <div class="row" style="font-size: 18px">
          <div class="col-auto pe-5">COM:<br>
            <span class="fw-bold text-primary" *ngIf="selectedPort">{{selectedPort.comName}}</span>
            <span class="fw-bold text-secondary" *ngIf="!selectedPort">-</span>
          </div>
          <div class="col-auto pe-5">Modul:<br>
            <span class="fw-bold text-success" *ngIf="ati">{{ati.model}}</span>
            <span class="fw-bold text-secondary" *ngIf="!ati">-</span>
          </div>
          <div class="col-auto pe-5">SIM:<br>
            <span class="fw-bold text-success">Bereit</span>
          </div>
          <div class="col-auto pe-5">Signal:<br>
            <span class="fw-bold text-success" *ngIf="csq && csq.length >= 1 && (csq[csq.length - 1].quality === 'Excellent' || csq[csq.length - 1].quality === 'Good')">{{csq[csq.length - 1].dbm}} dBm ({{csq[csq.length - 1].quality}})</span>
            <span class="fw-bold text-warning" *ngIf="csq && csq.length >= 1 && csq[csq.length - 1].quality === 'Ok'">{{csq[csq.length - 1].dbm}} dBm ({{csq[csq.length - 1].quality}})</span>
            <span class="fw-bold text-danger" *ngIf="csq && csq.length >= 1 && (csq[csq.length - 1].quality === 'Bad' || csq[csq.length - 1].quality === 'Very Bad')">{{csq[csq.length - 1].dbm}} dBm ({{csq[csq.length - 1].quality}})</span>
            <span class="fw-bold text-secondary" *ngIf="!csq || csq.length < 1">-</span>
          </div>
          <div class="col-auto pe-5">AT Status:<br>
            <span class="fw-bold text-secondary" *ngIf="atStatus === 'OK'">OK</span>
            <span class="fw-bold text-warning" *ngIf="atStatus === 'WAITING'">Warte auf: {{lastCommand}}</span>
            <span class="fw-bold text-danger" *ngIf="atStatus === 'SYSTEM_ERROR'">Fehler</span>
          </div>
        </div>
        <hr>
      </section>

      <section *ngIf="tab === 'connect'">
        <h5 class="mt-3">Einstellungen:</h5>
        <div class="row">
          <div class="col-8">
            <div class="label">Port</div>
            <div class="input-group input-group-sm">
              <select class="form-select form-select-sm" [(ngModel)]="selectedPortId" (ngModelChange)="selectPort(selectedPortId)">
                <option *ngFor="let port of ports" [value]="port.path">{{port.comName}}</option>
              </select>
              <button class="btn btn-sm btn-success" (click)="getAllPorts()">Update</button>
            </div>
          </div>
        </div>
        <hr *ngIf="selectedPort">
        <h5 *ngIf="selectedPort">Schnittstelle:</h5>
        <div class="row" *ngIf="selectedPort">
          <div class="col-3">
            <div class="label">COM Name</div>
            <div>{{selectedPort.comName}}</div>
          </div>
          <div class="col-3">
            <div class="label">COM Hersteller</div>
            <div>{{selectedPort.manufacturer}}</div>
          </div>
          <div class="col-12" *ngIf="selectedPort.pnpId && selectedPort.pnpId !== ''">
            <div class="label">PNP ID</div>
            <div>{{selectedPort.pnpId}}</div>
          </div>
          <div class="col-3">
            <div class="label">Status</div>
            <div *ngIf="connected === 'CONNECTED'" class="fw-bold text-success">Verbunden</div>
            <div *ngIf="connected === 'ERROR'" class="fw-bold text-danger">Fehler</div>
            <div *ngIf="connected === 'CONNECTING'" class="fw-bold text-warning">Verbindet</div>
            <div *ngIf="connected === 'NOT_CONNECTED'" class="fw-bold text-secondary">Nicht verbunden</div>
          </div>
          <div class="col-12 mt-3">
            <button *ngIf="connected !== 'CONNECTED'" class="btn me-2 btn-primary" (click)="connectToPort()" [disabled]="!selectedPort">Verbinden</button>
            <button *ngIf="connected === 'CONNECTED'" class="btn me-2 btn-danger" (click)="closePort()">Trennen</button>
          </div>
        </div>
        <hr>
        <h5>Verbundenes Modul:</h5>
        <div class="row" *ngIf="ati">
          <div class="col-12">
            <div class="label">Hersteller</div>
            <div>{{ati.manufacturer}}</div>
          </div>
          <div class="col-12">
            <div class="label">Modul</div>
            <div>{{ati.model}}</div>
          </div>
          </div>
        <span *ngIf="!ati">Kein Modul verbunden</span>
      </section>

      <section *ngIf="tab === 'network'">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="checkCSQActive" [(ngModel)]="checkCSQActive">
          <label class="form-check-label" for="checkCSQActive">Signalstärke überwachen</label>
        </div>
      </section>

      <section *ngIf="tab === 'at'">
        <div class="mb-3">
          <div class="row">
            <div class="col-12">
              <h5>Konsole:</h5>
              <div class="overflow-auto border rounded w-100 mb-3 p-3" style="height: 500px">
                <pre class="d-block m-0" style="overflow-x: hidden" [ngClass]="{'green-text': rawItem.isSend}" *ngFor="let rawItem of rawData"><span>{{rawItem.date | date:'dd.MM.yy HH:mm:ss'}}</span> - {{rawItem.data}}</pre>
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="label">Befehl senden</div>
                  <div class="input-group input-group-sm mb-3">
                    <input class="form-control form-control-sm" type="text" placeholder="Befehl eingeben" [(ngModel)]="inputStringRaw" [disabled]="atStatus !== 'OK'">
                    <button class="btn btn-sm btn-secondary" [ngClass]="{'disabled': atStatus !== 'OK'}" (click)="sendRawMessage()">Senden</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>


</main>


